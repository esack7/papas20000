"use strict";function randomId(){return window.crypto.getRandomValues(new Uint32Array(1))[0].toString(16)}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}class Player{constructor(e,t="player"+randomId(),n=[],a=0){this.id=t,this.name=e,this.scores=n,this.totalScore=a}addRoundPoints(e){if(0===this.totalScore&&e<1e3&&0!==e)this.scores.push(0);else{if(this.totalScore+e>Game.winningScore)throw this.scores.push(0),new Error("Over20000");if(e%50!=0)throw new Error("Not multiple of 50");this.scores.push(e),this.totalScore=this.scores.reduce((e,t)=>e+t),this.totalScore===Game.winningScore&&playLastRound(this)}}getScoresArray(){return this.scores.map(e=>e.toString())}getTotalScore(){return this.totalScore}}class Game{constructor(e=`game${randomId()}`,t=[],n=[],a=0,o=!0,r=!1,d="",c=!1,i=""){this.id=e,this.winnersBracket=n,this.currentPlayIndex=a,this.activeGame=o,this.lastRound=r,this.gameWarningText=d,this.errorState=c,this.previousState=i,0===t.length?this.players=t:this.players=t.map(e=>0===e.scores.length?new Player(e.name,e.id,e.scores,0):new Player(e.name,e.id,e.scores,e.scores.reduce((e,t)=>e+t)))}addPlayer(e){this.players.push(e)}getCurrentPlayer(){return this.players[this.currentPlayIndex]}nextTurn(){const e=this.players.length;this.currentPlayIndex+=1,this.currentPlayIndex>=e&&(this.currentPlayIndex=0)}addToWinnersBracket(e){this.winnersBracket.push(e.name)}}Game.winningScore=2e4;const loginSection=document.getElementById("login"),addusersSection=document.getElementById("addusers"),gameplaySection=document.getElementById("gameplay"),gameOverSection=document.getElementById("gameOver"),menuSection=document.getElementById("menu"),leaderboardSection=document.getElementById("leaderboard"),totalScore=document.getElementById("totalScore"),scoreInput=document.getElementById("roundScore"),playerInput=document.getElementById("playername"),playersList=document.getElementById("listOfPlayers"),addPlayerButton=document.getElementById("addplayer"),addToScoreButton=document.getElementById("addToScore"),showMenuButton=document.getElementById("showMenu"),closeMenuButton=document.getElementById("closeMenu"),closeLeaderboard=document.getElementById("closeLeaderboard"),cancelGameButton=document.getElementById("cancelGame"),showLeaderboardButton=document.getElementById("showLeaderboard"),undoButton=document.getElementById("undoLastMove"),prevScoresList=document.getElementById("previousScores"),currentPlayerTitle=document.getElementById("currentPlayer"),gameWarning=document.getElementById("gameWarning"),previousScore=document.getElementById("previousScore"),endTitle=document.getElementById("endTitle"),endScores=document.getElementById("endScores"),leaderboardScores=document.getElementById("leaderboardScores"),reloadPageButton=document.getElementById("reloadPage");let game;function startGame(e){if(null!=e.target){"Start Game"===e.target.innerText&&(addusersSection.hidden?(loginSection.hidden=!0,addusersSection.hidden=!1,game=new Game):addusersSection.hidden||0===game.players.length||(addusersSection.hidden=!0,gameplaySection.hidden=!1,localStorage.setItem("recentGame",JSON.stringify(game)),handlePostScoreDisplay()))}}function handleAddPlayerClick(){const e=playerInput.value.trim();playerInput.value="",playersList.innerHTML="",""!==e&&game.addPlayer(new Player(e)),game.players.forEach(e=>{const t=document.createElement("li");t.appendChild(document.createTextNode(e.name)),playersList.appendChild(t)})}function handleAddToScoreClick(){game.previousState="",game.previousState=JSON.stringify(game);const e=parseInt(scoreInput.value);if(game.errorState=!1,scoreInput.value="",!isNaN(e)){prevScoresList.innerHTML="";const t=game.getCurrentPlayer();try{game.getCurrentPlayer().addRoundPoints(e)}catch(e){if(game.errorState=!0,"Over20000"===e.message&&(game.gameWarningText=`${t.name}'s total score went over 20,000 so their last score was zero`),"Not multiple of 50"===e.message)return game.gameWarningText="The score must be a multiple of 50.",localStorage.setItem("recentGame",JSON.stringify(game)),void handlePostScoreDisplay()}game.nextTurn(),localStorage.setItem("recentGame",JSON.stringify(game)),handlePostScoreDisplay()}}function handlePostScoreDisplay(){const e=game.getCurrentPlayer();let t;if(gameWarning.hidden=!0,t=0===game.currentPlayIndex?game.players[game.players.length-1]:game.players[game.currentPlayIndex-1],game.lastRound&&game.winnersBracket.includes(e.name))1===game.winnersBracket.length?handleWin(e):handleShowdown(game);else{const n=e.getTotalScore(),a=t.getScoresArray();0===n&&(game.errorState=!0,game.gameWarningText="You must score at least 1000 points to get on the board, otherwise your score is 0 for this round."),game.errorState&&(gameWarning.innerText=game.gameWarningText,gameWarning.hidden=!1),a.length>0&&0!==n&&(previousScore.innerText=`${t.name}'s score was ${a[a.length-1]}`,previousScore.hidden=!1),currentPlayerTitle.innerText=`${e.name}'s turn`,totalScore.innerText=n.toString(),e.getScoresArray().forEach(e=>{const t=document.createElement("li");t.appendChild(document.createTextNode(e)),prevScoresList.appendChild(t)})}}function playLastRound(e){game.lastRound=!0,game.addToWinnersBracket(e)}function handleWin(e){gameplaySection.hidden=!0,gameOverSection.hidden=!1,endTitle.innerText=`${e.name} has won the game!!!`,game.players.forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td");n.appendChild(document.createTextNode(e.name)),t.appendChild(n);const a=document.createElement("td");a.appendChild(document.createTextNode(e.getTotalScore().toLocaleString())),t.appendChild(a),endScores.appendChild(t)}),game.activeGame=!1,localStorage.setItem("recentGame",JSON.stringify(game))}function handleShowdown(e){gameplaySection.hidden=!0,gameOverSection.hidden=!1;let t="\n";e.winnersBracket.forEach(e=>t=t+e+"\n"),endTitle.innerText=`The following players tied at 20,000 points each!\n    ${t}\n    Time for a SHOWDOWN!!!`,e.players.forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td");n.appendChild(document.createTextNode(e.name)),t.appendChild(n);const a=document.createElement("td");a.appendChild(document.createTextNode(e.getTotalScore().toLocaleString())),t.appendChild(a),endScores.appendChild(t)}),e.activeGame=!1,localStorage.setItem("recentGame",JSON.stringify(e))}function playAgain(){window.location.reload()}function loadGame(e){game=new Game(e.id,e.players,e.winnersBracket,e.currentPlayIndex,e.activeGame,e.lastRound,e.gameWarningText,e.errorState),loginSection.hidden=!0,addusersSection.hidden=!0,gameplaySection.hidden=!1,handlePostScoreDisplay()}function handleShowMenuClick(){""===game.previousState?undoButton.hidden=!0:undoButton.hidden=!1,gameplaySection.hidden=!0,menuSection.hidden=!1}function handleCloseMenuClick(){menuSection.hidden=!0,gameplaySection.hidden=!1}function handleCancelGame(){game.activeGame=!1,localStorage.setItem("recentGame",JSON.stringify(game)),window.location.reload()}function handleUndoLastScore(){localStorage.setItem("recentGame",game.previousState),window.location.reload()}function handleShowLeaderboard(){menuSection.hidden=!0,leaderboardSection.hidden=!1,removeAllChildNodes(leaderboardScores);const e=[];game.players.forEach(t=>e.push(t)),e.sort((e,t)=>t.getTotalScore()-e.getTotalScore()).forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td");n.appendChild(document.createTextNode(e.name)),t.appendChild(n);const a=document.createElement("td");a.appendChild(document.createTextNode(e.getTotalScore().toLocaleString())),t.appendChild(a),leaderboardScores.appendChild(t)})}function handleCloseLeaderboard(){leaderboardSection.hidden=!0,gameplaySection.hidden=!1}window.onload=(()=>{if(localStorage.recentGame){const e=JSON.parse(localStorage.recentGame);e.activeGame&&loadGame(e)}}),loginSection.addEventListener("click",e=>startGame(e)),addusersSection.addEventListener("click",e=>startGame(e)),addToScoreButton.addEventListener("click",handleAddToScoreClick),addPlayerButton.addEventListener("click",handleAddPlayerClick),reloadPageButton.addEventListener("click",playAgain),showMenuButton.addEventListener("click",handleShowMenuClick),closeMenuButton.addEventListener("click",handleCloseMenuClick),cancelGameButton.addEventListener("click",handleCancelGame),undoButton.addEventListener("click",handleUndoLastScore),showLeaderboardButton.addEventListener("click",handleShowLeaderboard),closeLeaderboard.addEventListener("click",handleCloseLeaderboard);